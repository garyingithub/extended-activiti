<definitions id="definitions"
             xmlns:activiti="http://activiti.org/bpmn"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             targetNamespace="http://service.activiti.engine.cloud.workflow.sysu.edu.cn/"
             xmlns:tns="http://service.activiti.engine.cloud.workflow.sysu.edu.cn/"
             xmlns:calculator="http://service.activiti.engine.cloud.workflow.sysu.edu.cn/">

    <import importType="http://schemas.xmlsoap.org/wsdl/"
            location="http://localhost:9090/calculator?wsdl"
            namespace="http://service.activiti.engine.cloud.workflow.sysu.edu.cn/" />

    <process id="financialReport" name="Monthly financial report reminderprocess">

        <startEvent id="theStart" />

        <sequenceFlow id='flow1' sourceRef='theStart' targetRef='writeReportTask' />

        <userTask id="writeReportTask" name="Write monthly financial report" >
            <documentation>
                Write monthly financial reportfor publication to shareholders.
            </documentation>
            <!--<potentialOwner>-->
                <!--<resourceAssignmentExpression>-->
                    <!--<formalExpression>sales</formalExpression>-->
                <!--</resourceAssignmentExpression>-->
            <!--</potentialOwner>-->
        </userTask>

        <!--<sequenceFlow id='flow2' sourceRef='writeReportTask' targetRef='verifyReportTask' />-->
        <sequenceFlow id='flow2' sourceRef='writeReportTask' targetRef='servicetask1' />

        <serviceTask id="servicetask1" name="calculator" implementation="##WebService"
                     operationRef="tns:plusOperation">

            <!-- activiti流程变量和webservice的输入输出参数的转换 -->
            <dataInputAssociation>
                <sourceRef>input1</sourceRef><!-- name of an Activiti variable -->
                <targetRef>num1</targetRef><!-- name of an element of the input message -->
            </dataInputAssociation>
            <dataInputAssociation>
                <sourceRef>input2</sourceRef><!-- name of an Activiti variable -->
                <targetRef>num2</targetRef><!-- name of an element of the input message -->
            </dataInputAssociation>
            <dataOutputAssociation>
                <sourceRef>num3</sourceRef><!-- name of an element of the output message -->
                <targetRef>output3</targetRef><!-- name of an Activiti variable -->
            </dataOutputAssociation>
        </serviceTask>


        <!--<userTask id="verifyReportTask" name="Verify monthly financial report" >-->
            <!--<documentation>-->
                <!--Verify monthly financial reportcomposed by the accountancy department.-->
                <!--This financial report is goingto be sent to all the company shareholders.-->
            <!--</documentation>-->
            <!--&lt;!&ndash;<potentialOwner>&ndash;&gt;-->
                <!--&lt;!&ndash;<resourceAssignmentExpression>&ndash;&gt;-->
                    <!--&lt;!&ndash;<formalExpression>management</formalExpression>&ndash;&gt;-->
                <!--&lt;!&ndash;</resourceAssignmentExpression>&ndash;&gt;-->
            <!--&lt;!&ndash;</potentialOwner>&ndash;&gt;-->
        <!--</userTask>-->

        <!--<sequenceFlow id='flow3' sourceRef='verifyReportTask' targetRef='theEnd' />-->
        <sequenceFlow id='flow3' sourceRef='servicetask1' targetRef='theEnd' />

        <endEvent id="theEnd" />

    </process>
     <!--webservice的传入传出参数(webservice服务端明确指出),以及activiti执行代码中传入的参数引用 -->
    <itemDefinition id="num1" structureRef="int" />
    <itemDefinition id="num2" structureRef="int" />
    <itemDefinition id="num3" structureRef="int" />
    <itemDefinition id="input1" structureRef="int" />
    <itemDefinition id="input2" structureRef="int" />
    <itemDefinition id="output3" structureRef="int" />

    <!--&lt;!&ndash; 一个webservice方法操作调用的定义  implementationRef="calculator:Calculator" 中 Calculator 即 portType的引用 &ndash;&gt;-->
    <interface name="Calculator Interface" implementationRef="calculator:Calculator">
        <!-- Operation: implementationRef = QName of WSDL Operation -->
        <operation id="plusOperation" name="plusOperation Operation" implementationRef="calculator:plus">
            <inMessageRef>tns:plusRequestMessage</inMessageRef>
            <outMessageRef>tns:plusResponseMessage</outMessageRef>
        </operation>
    </interface>

    <message id="plusRequestMessage" itemRef="tns:plusRequestItem" />
    <message id="plusResponseMessage" itemRef="tns:plusResponseItem" />

    <itemDefinition id="plusRequestItem" structureRef="calculator:plus" />
    <itemDefinition id="plusResponseItem" structureRef="calculator:plusResponse" />

</definitions>